{
    "appname": "Application unreachable 12/06/2021",
    "class": [
        "regular_node"
    ],
    "comments": [
        {
            "text": "",
            "tstp": 1586809405.506942,
            "user_info": {
                "first_name": "Krishna",
                "last_name": "Yadp",
                "org": "DagknowsDemo",
                "role": "Admin",
                "uname": "krishna+dagknowsdemo@dagknows.com"
            }
        },
        {
            "text": "",
            "tstp": 1587926529.6078992,
            "user_info": {
                "first_name": "",
                "last_name": "",
                "org": "ec2",
                "role": "Admin",
                "uname": "binu+ec2@kodelounge.com"
            }
        },
        {
            "text": "",
            "tstp": 1588878390.7227983,
            "user_info": {
                "first_name": "",
                "last_name": "",
                "org": "ec2",
                "role": "Admin",
                "uname": "krishna+ec2@dagknows.com"
            }
        },
        {
            "text": "",
            "tstp": 1588878620.2548401,
            "user_info": {
                "first_name": "",
                "last_name": "",
                "org": "ec2",
                "role": "Admin",
                "uname": "krishna+ec2@dagknows.com"
            }
        },
        {
            "text": "",
            "tstp": 1588878665.378221,
            "user_info": {
                "first_name": "",
                "last_name": "",
                "org": "ec2",
                "role": "Admin",
                "uname": "krishna+ec2@dagknows.com"
            }
        },
        {
            "text": "",
            "tstp": 1588879277.733976,
            "user_info": {
                "first_name": "",
                "last_name": "",
                "org": "ec2",
                "role": "Admin",
                "uname": "krishna+ec2@dagknows.com"
            }
        },
        {
            "text": "",
            "tstp": 1590075207.7115283,
            "user_info": {
                "first_name": "",
                "last_name": "",
                "org": "ec2",
                "role": "Admin",
                "uname": "krishna+ec2@dagknows.com"
            }
        },
        {
            "text": "",
            "tstp": 1590262727.16707,
            "user_info": {
                "first_name": "SME",
                "last_name": "Sarang",
                "org": "ec2",
                "role": "Admin",
                "uname": "sarang@dagknows.com"
            }
        },
        {
            "text": "",
            "tstp": 1590341352.9789577,
            "user_info": {
                "first_name": "Krishna",
                "last_name": "ec2",
                "org": "ec2",
                "role": "Admin",
                "uname": "krishna+ec2@dagknows.com"
            }
        },
        {
            "text": "",
            "tstp": 1595830399.1785913,
            "user_info": {
                "first_name": "Krishna",
                "last_name": "ec2",
                "org": "ec2",
                "role": "Admin",
                "uname": "krishna+ec2@dagknows.com"
            }
        },
        {
            "text": "",
            "tstp": 1604686925.8182573,
            "user_info": {
                "first_name": "SME",
                "last_name": "Sarang",
                "org": "ec2",
                "role": "Admin",
                "uname": "sarang@dagknows.com"
            }
        },
        {
            "text": "",
            "tstp": 1620178987.6285558,
            "user_info": {
                "first_name": "SME",
                "last_name": "Sarang",
                "org": "ec2",
                "role": "Admin",
                "uname": "sarang@dagknows.com"
            }
        }
    ],
    "conv_id": "ghThDbUNbs2n7RzG1L6oew",
    "currsession": "33DayrxmeasS0cPV",
    "description": "<p><span style=\"color: rgb(22, 25, 31);\">Check the route table for the subnet. You need a route that sends all traffic destined outside the VPC to the internet gateway for the VPC.</span></p>",
    "evidence": "import subprocess\n\n_problem = False\n\nfor instance_id in instance_ids:\n    _problem = False\n\n    cmd = \"aws ec2 describe-instances --filter Name=instance-id,Values=\"\n    cmd += instance_id + \" --query Reservations[*].Instances[*].VpcId --output=text\"\n    token = subprocess.check_output(cmd, shell=True)\n    vpc_id = token.decode(\"utf-8\").strip('\\n')\n\n    cmd = \"aws ec2 describe-route-tables --query RouteTables[*].Routes[*].[DestinationCidrBlock,GatewayId,State] \"\n    cmd += \"--output=text | grep -i '0.0.0.0/0' | grep active\"\n    token = subprocess.check_output(cmd, shell=True)\n    ig = token.decode(\"utf-8\").strip('\\n').split('\\t')\n\n    cmd = \"aws ec2 describe-internet-gateways --filter Name=internet-gateway-id,Values=\"\n    cmd += ig[1] + \" --query InternetGateways[*].[Attachments[*].[VpcId,State]] --output=text | grep \"\n    cmd += vpc_id + \" | wc -l\"\n\n    result = subprocess.check_output(cmd, shell=True)\n\n    if int(result) == 1:\n        _problem = False",
    "evidtype": "Script",
    "msg": "",
    "nodename": {
        "input_params": {
            "instance_ids": "instance_ids"
        },
        "node_func": "Missing subnet association with a route table that has a route for IPv4 traffic to an internet gateway"
    },
    "nodetype": "Problem",
    "prevnodename": {
        "node_func": "Missing subnet association with a route table that has a route for IPv4 traffic to an internet gateway"
    },
    "privacy_level": "internal",
    "related_convs": [],
    "res": "<ol><li>Open the Amazon EC2 console at&nbsp;</li><li><a href=\"https://console.aws.amazon.com/ec2/\" target=\"_blank\" style=\"color: var(--awsui-color-text-link-default,#0073bb);\">https://console.aws.amazon.com/ec2/</a></li><li>.</li><li>In the navigation pane, choose&nbsp;<strong>Instances</strong>, and then select your instance.</li><li>In the&nbsp;<strong>Description</strong>&nbsp;tab, write down the values of&nbsp;<strong>VPC ID</strong>&nbsp;and&nbsp;<strong>Subnet ID</strong>.</li><li>Open the Amazon VPC console at&nbsp;</li><li><a href=\"https://console.aws.amazon.com/vpc/\" target=\"_blank\" style=\"color: var(--awsui-color-text-link-default,#0073bb);\">https://console.aws.amazon.com/vpc/</a></li><li>.</li><li>In the navigation pane, choose&nbsp;<strong>Internet Gateways</strong>. Verify that there is an internet gateway attached to your VPC. Otherwise, choose&nbsp;<strong>Create Internet Gateway</strong>&nbsp;to create an internet gateway. Select the internet gateway, and then choose&nbsp;<strong>Attach to VPC</strong>&nbsp;and follow the directions to attach it to your VPC.</li><li>In the navigation pane, choose&nbsp;<strong>Subnets</strong>, and then select your subnet.</li><li>On the&nbsp;<strong>Route Table</strong>&nbsp;tab, verify that there is a route with&nbsp;<code style=\"background-color: rgb(242, 243, 243);\">0.0.0.0/0</code>&nbsp;as the destination and the internet gateway for your VPC as the target. If you're connecting to your instance using its IPv6 address, verify that there is a route for all IPv6 traffic (<code style=\"background-color: rgb(242, 243, 243);\">::/0</code>) that points to the internet gateway. Otherwise, do the following:</li><li class=\"ql-indent-1\">Choose the ID of the route table (rtb-<em>xxxxxxxx</em>) to navigate to the route table.</li><li class=\"ql-indent-1\">On the&nbsp;<strong>Routes</strong>&nbsp;tab, choose&nbsp;<strong>Edit routes</strong>. Choose&nbsp;<strong>Add route</strong>, use&nbsp;<code style=\"background-color: rgb(242, 243, 243);\">0.0.0.0/0</code>&nbsp;as the destination and the internet gateway as the target. For IPv6, choose&nbsp;<strong>Add route</strong>, use&nbsp;<code style=\"background-color: rgb(242, 243, 243);\">::/0</code>&nbsp;as the destination and the internet gateway as the target.</li><li class=\"ql-indent-1\">Choose&nbsp;<strong>Save routes</strong>.</li></ol><p><br></p>",
    "restype": "Description",
    "state": "approved",
    "tags": {
        "_dag": "Connectivity",
        "automatable": "yes",
        "automatable-diagnose": "yes",
        "automatable-resolve": "yes",
        "difficulty": "medium"
    },
    "node_id": "OCF1d5jMz8nfT8Zu",
    "metadata": {
        "create_tstp": 1662428424.4063203,
        "create_username": "info@dagknows.com"
    }
}